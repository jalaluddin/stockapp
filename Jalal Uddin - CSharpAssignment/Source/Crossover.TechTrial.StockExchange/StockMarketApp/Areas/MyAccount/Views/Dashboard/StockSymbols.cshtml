@using StockMarketSharedLibrary
@{
    ViewBag.Title = "My Stock Symbols";
}
@section styles
{
    <link href="~/Content/DataTables/css/dataTables.bootstrap.min.css" rel="stylesheet" />
}
<h2>@ViewBag.Title.</h2>
<section class="content">
    <div class="row">
        <div class="col-xs-12">
            @Html.BootstrapValidationSummary(StockMarketApp.Models.UserSession.ActionResponseMessage)
            @Html.AntiForgeryToken()
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">
                        <button class="btn btn-primary" onclick="window.location = '/MyAccount/Dashboard/AddStockSymbol'"><i class='glyphicon glyphicon-plus'></i>&nbsp;Create New</button>
                        &nbsp;<button class="btn btn-danger" data-target="#deleteModal" data-toggle='modal' id="deleteitems" type="button" disabled="disabled"><i class='glyphicon glyphicon-trash'></i>&nbsp;Delete</button>
                    </h3>
                </div><!-- /.box-header -->
                <div class="box-body table-responsive">
                    <table id="symbols" class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="checkall" /></th>
                                <th>Ticker</th>
                                <th></th>
                            </tr>
                        </thead>
                    </table>
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div>
    </div>

</section><!-- /.content -->


@section scripts
{
    <script src="~/Scripts/DataTables/jquery.dataTables.js"></script>
    <script src="~/Scripts/DataTables/dataTables.bootstrap.js"></script>
    <script src="~/Scripts/extensions.js"></script>
    <script src="~/Scripts/framework.js"></script>
    <script type="text/javascript">
        var selectedRows = Array();
        $(document).ready(function () {
            $('#symbols').dataTable({
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": '/MyAccount/Dashboard/GridDataForSymbols',
                "aoColumnDefs": [
                    {
                        "mRender": function (data, type, full) {
                            return "<input class='itemcheckbox' type='checkbox' value='" + data + "'/> ";
                        },
                        'bSortable': false,
                        "aTargets": [0]
                    },
                    {
                        "mRender": function (data, type, full) {
                            return "<a href='#deleteModal' data=" + data + " class='btn btn-danger btn-sm delete' data-toggle='modal'><i class='glyphicon glyphicon-trash text-error'></i></a> ";
                        },
                        'bSortable': false,
                        "aTargets": [2]
                    }
                ],
                "fnDrawCallback": function (oSettings) {
                    OnBeforeLoad(selectedRows);
                }
            });

            $('#symbols').on('click', '.delete', function (event) {
                OnRowSelected(selectedRows, $(this).attr('data'), true);
                $("#deleteModal .confirm").unbind();
                $("#deleteModal .confirm").click(function (event) {
                    createDeleteFormAndSubmit(selectedRows, "ids", "/MyAccount/Dashboard/DeleteStockSymbol");
                });
            });

            $("#deleteitems").click(function () {
                $("#deleteModal .confirm").unbind();
                $("#deleteModal .confirm").click(function (event) {
                    createDeleteFormAndSubmit(selectedRows, "ids", "/MyAccount/Dashboard/DeleteStockSymbol");
                });
            });

            $('#symbols').on('click', '.itemcheckbox', function (event) {
                var id = $(this).val();
                var status = $(this).prop('checked');
                OnRowSelected(selectedRows, id, status);
            });

            $("#checkall").click(function () {
                var status = $(this).prop("checked");
                $(".itemcheckbox").prop("checked", status);
                var idArray = Array();
                $(".itemcheckbox").each(function (index, item) {
                    idArray.push($(item).val());
                });
                OnAllRowSelected(selectedRows, idArray, status);
            });
        });
    </script>
}